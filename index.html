<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Ø£Ù†ÙŠØ³ â€“ ÙÙŠØ²ÙŠØ§Ø¡</title>

<!-- Ø®Ø· Ø£Ù…ÙŠØ±ÙŠ -->
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet"/>

<style>
:root{
  /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Ù‡Ø§Ø± (Ø£Ø®Ø¶Ø±) */
  --ink:#0d1b16;           /* Ù†Øµ Ø£Ø³Ø§Ø³ÙŠ */
  --muted:#5b7a68;
  --bg:#f3fbf6;
  --bg2:#e9f6ee;
  --card:#ffffff;
  --accent:#1d8f4b;        /* Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ† Ù„Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† */
  --accent2:#2fb06a;       /* ØªØ¯Ø±Ù‘Ø¬ Ø§Ù„Ø²Ø± */
  --soft:#d9f2e4;          /* Ø­Ø¯ÙˆØ¯/Ù…Ø³Ø§Ø­Ø§Øª */
  --chip:#e9f6ee;
  --radius:16px;
}

/* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
html.dark{
  --ink:#e9fff3;
  --muted:#b8d2c3;
  --bg:#05110c;
  --bg2:#0b1f16;
  --card:#0f231a;
  --accent:#22c55e;
  --accent2:#16a34a;
  --soft:#184c35;
  --chip:#0f2b20;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;color:var(--ink);
  font-family:"Amiri", system-ui, -apple-system, "Segoe UI", Cairo, Roboto, sans-serif;
  background:
   radial-gradient(900px 500px at 0% -10%,var(--bg2),transparent 60%),
   radial-gradient(900px 500px at 100% 110%,var(--bg),transparent 60%),
   linear-gradient(180deg,var(--bg),var(--bg2) 85%);
}

/* Ø²Ø®Ø±ÙØ© Ø®ÙÙŠÙØ© (Ø£ÙˆØ±Ø§Ù‚) */
body:before{
  content:"";
  position:fixed; inset:0; pointer-events:none; opacity:.15;
  background:
   radial-gradient(12px 8px at 20% 15%, var(--soft), transparent 60%),
   radial-gradient(10px 7px at 80% 30%, var(--soft), transparent 60%),
   radial-gradient(12px 8px at 30% 80%, var(--soft), transparent 60%),
   radial-gradient(10px 7px at 70% 70%, var(--soft), transparent 60%);
  filter: blur(.6px);
}

.wrap{max-width:1100px;margin:0 auto;padding:22px;min-height:100vh;display:flex;flex-direction:column}

header{text-align:center;margin:8px 0 16px}
header h1{
  font-size:clamp(30px,5.2vw,48px);
  margin:6px 0 6px;font-weight:700;letter-spacing:.3px;
  color:var(--accent);
  display:flex;gap:.6rem;align-items:center;justify-content:center;
}
.icon-dots{
  display:inline-flex; gap:4px; align-items:center; transform:translateY(-2px);
}
.icon-dots span{
  width:.58em;height:.58em;border-radius:999px;background:var(--accent);
  display:inline-block;
}

header p{color:var(--muted);margin:4px 0 0;font-size:clamp(14px,2.3vw,18px)}

.toggle{
  background:var(--card); border:1px solid var(--soft); color:var(--ink);
  padding:.45rem .9rem;border-radius:999px; box-shadow:0 6px 20px rgba(0,0,0,.06);
}

.card{background:var(--card);border:1px solid var(--soft);border-radius:var(--radius);box-shadow:0 12px 30px rgba(0,0,0,.08)}
.pad{padding:14px}

.inputs{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
.input{width:min(560px,100%);padding:10px;border-radius:10px;border:1px solid var(--soft);font-size:1rem;background:#fff0}
.input::placeholder{color:var(--muted)}

.toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
.btn{
  background:linear-gradient(180deg,var(--accent2),var(--accent));
  color:#fff;border:none;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;
  box-shadow:0 10px 22px rgba(22,163,74,.25);font-size:clamp(14px,2.4vw,16px)
}
.btn:disabled{opacity:.6;cursor:not-allowed}

.status{color:var(--muted);font-size:.95rem;text-align:center;min-height:1.2em}
.err{background:#fee2e2;color:#991b1b;border:1px solid #fecaca;padding:10px;border-radius:12px;display:none}

.sec{display:none;margin-top:12px}
.box{background:var(--chip);border:1px solid var(--soft);padding:12px;border-radius:12px}
.box ul,.box ol{margin:0 1.1rem}
.tag{display:inline-block;padding:.28rem .7rem;border-radius:999px;background:var(--chip);border:1px solid var(--soft);color:var(--ink);font-size:.9rem}

.math-inline,.math-block{direction:ltr;unicode-bidi:isolate}
.math-block{display:block;margin:.35rem auto;text-align:center}

h2.section{color:var(--accent);margin:0 0 8px 0;font-weight:700;text-align:center}
h3.sub{color:var(--accent);margin:10px 0 6px 0;font-weight:700}

.table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px;border:1px solid var(--soft)}
.table th,.table td{border-bottom:1px solid var(--soft);padding:10px 12px;font-size:16px;text-align:center;vertical-align:middle}
.table th{background:var(--bg2);font-weight:700}
.table tr:last-child td{border-bottom:none}
.unit-cell{direction:ltr}

/* ØªØ±Ù‚ÙŠÙ… Ù…ÙˆØ­Ù‘Ø¯ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ */
ol{list-style-type:decimal;padding-inline-start:1.25rem}
ol li{direction:rtl}

/* ØªØ°ÙŠÙŠÙ„ */
footer{margin-top:auto;text-align:center;color:var(--muted);padding:16px 0 40px}
footer .line{margin-top:14px;font-weight:700;color:var(--ink);display:flex;gap:.6rem;align-items:center;justify-content:center}
footer .sig{margin-top:6px;color:var(--ink);font-weight:700}
</style>

<!-- MathJax -->
<script>
window.MathJax={tex:{
  inlineMath:[['$','$'],['\\(','\\)']],
  displayMath:[['$$','$$'],['\\[','\\]']],
  processEscapes:true,
  packages:{'[+]':['noerrors','noundefined']}
}};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>
<div class="wrap">

  <div style="display:flex;justify-content:flex-start;align-items:center;margin-bottom:6px;">
    <button id="toggleTheme" class="toggle">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†</button>
  </div>

  <header>
    <div class="icon-dots" aria-hidden="true"><span></span><span></span><span></span></div>
    <h1>Ø£Ù†ÙŠØ³ â€“ ÙÙŠØ²ÙŠØ§Ø¡</h1>
    <div class="icon-dots" aria-hidden="true"><span></span><span></span><span></span></div>
    <p>Ø§Ù„ØªÙÙ‘Ù…ÙŠÙÙ‘Ø² ÙˆØ§Ù„Ù†Ø¬Ø§Ø­ ÙŠØ¨Ø¯Ø£ Ø¨Ø®Ø·ÙˆØ©.</p>
  </header>

  <section class="card pad" style="text-align:center;">
    <div class="inputs">
      <input id="concept" class="input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†/Ø§Ù„Ù…ÙÙ‡ÙˆÙ…: Ù‚Ø§Ù†ÙˆÙ† Ù†ÙŠÙˆØªÙ† Ø§Ù„Ø«Ø§Ù†ÙŠØŒ Ø§Ù„Ø¬Ø°Ø¨ Ø§Ù„Ø¹Ø§Ù…ØŒ Ø§Ù„Ø³Ù‚ÙˆØ· Ø§Ù„Ø­Ø±â€¦"/>
    </div>
    <div class="toolbar">
      <button class="btn" id="btnExplain">Ø§Ø´Ø±Ø­ Ù„ÙŠ ğŸ“˜</button>
      <button class="btn" id="btnEx1">Ù…Ø«Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ÙŠ ğŸ’¡</button>
      <button class="btn" id="btnEx2">Ù…Ø«Ø§Ù„ Ø¢Ø®Ø± ğŸ’¡</button>
      <button class="btn" id="btnPractice">Ø§Ø®ØªØ¨Ø± ÙÙ‡Ù…ÙŠ ğŸ“</button>
      <button class="btn" id="btnSolve">Ø§Ù„Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­ ğŸ”‘</button>
    </div>
    <div id="status" class="status"></div>
    <div id="error" class="err"></div>
  </section>

  <!-- Ø§Ø´Ø±Ø­ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† -->
  <section id="secExplain" class="sec card pad" aria-live="polite">
    <h2 id="exTitle" class="section"></h2>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin:-4px 0 10px;justify-content:center;">
      <span class="tag">ÙÙŠØ²ÙŠØ§Ø¡</span><span id="chip2" class="tag"></span>
    </div>
    <div id="overview" class="box center" style="text-align:right;line-height:1.7;"></div>

    <h3 class="sub" style="text-align:center">Ø§Ù„ØµÙŠØº</h3>
    <div id="expFormulas" class="box center"></div>

    <h3 class="sub" style="text-align:center">Ø§Ù„Ø±Ù…ÙˆØ² ÙˆØ§Ù„ÙˆØ­Ø¯Ø§Øª</h3>
    <div class="center">
      <table id="symbolsTbl" class="table">
        <thead>
          <tr>
            <th>Ø§Ù„ÙˆØµÙ</th>
            <th>Ø§Ù„Ø±Ù…Ø²</th>
            <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
          </tr>
        </thead>
        <tbody id="symbols"></tbody>
      </table>
    </div>

    <h3 class="sub" style="text-align:center">Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…/Ø§Ù„Ø­Ù„</h3>
    <ol id="steps" class="box center" style="text-align:right;line-height:1.7;"></ol>
  </section>

  <!-- Ù…Ø«Ø§Ù„/Ù…Ø«Ø§Ù„ Ø¢Ø®Ø±/Ø³Ø¤Ø§Ù„/Ø­Ù„ -->
  <section id="secEx1" class="sec card pad"><h2 class="section">Ù…Ø«Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ÙŠ</h2><div id="ex1" class="box"></div></section>
  <section id="secEx2" class="sec card pad"><h2 class="section">Ù…Ø«Ø§Ù„ Ø¢Ø®Ø±</h2><div id="ex2" class="box"></div></section>
  <section id="secPractice" class="sec card pad"><h2 class="section">Ø§Ø®ØªØ¨Ø± ÙÙ‡Ù…ÙŠ</h2><div id="practice" class="box"></div></section>
  <section id="secSolve" class="sec card pad">
    <h2 class="section">Ø§Ù„Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­</h2>
    <div id="solve" class="box"></div>
    <div class="line">
      <span>Ù„ÙƒÙÙ„ÙÙ‘ Ø´ÙŠØ¡Ù ØµØ¹Ø¨Ù ÙÙŠ Ø­ÙŠØ§ØªÙÙ†Ø§ Ø­Ù„Ù‘</span>
      <div class="icon-dots" aria-hidden="true" style="transform:none"><span></span><span></span><span></span></div>
    </div>
    <div class="sig">Ù†Ø¯Ù‰ Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…Ø¬ÙŠØ±Ø´</div>
  </section>

  <footer>
    <div>Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„ØªØ¨Ø³ÙŠØ· Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© ÙˆØ§Ù„Ø¬Ø§Ù…Ø¹Ø©</div>
  </footer>
</div>

<!-- ========== Math helpers ========== -->
<script>
(function(){
  function cleanMath(s){ s=(s||'').replace(/\r/g,'\n').replace(/\n{3,}/g,'\n\n'); s=s.replace(/\\\\/g,'\\'); return s.trim(); }
  function fixLatex(s){
    s=cleanMath(s);
    s=s.replace(/(^|[^\\])\b(frac|sqrt|mathrm|cdot)\b/g,'$1\\$2');
    return s;
  }
  function htmlWithMath(input){
    let s=fixLatex(input||'');
    const blocks=[], inlines=[];
    s=s.replace(/(^|[\s])\$([\s]|$)/g,'$1');      /* $å­¤ */
    s=s.replace(/\$\$([\s\S]*?)\$\$/g,(m,inner)=>{blocks.push('$$'+inner+'$$');return 'Â§Â§B'+(blocks.length-1)+'Â§Â§';});
    s=s.replace(/\$([^$]+)\$/g,(m,inner)=>{inlines.push('$'+inner+'$');return 'Â§Â§I'+(inlines.length-1)+'Â§Â§';});
    s=s.replace(/\$/g,'');                        /* Ù…Ø³Ø­ Ø£ÙŠ $ Ù…ØªØ¨Ù‚ÙŠØ© */
    s=s.replace(/Â§Â§B(\d+)Â§Â§/g,(m,i)=>`<div class="math-block">${blocks[i]}</div>`)
       .replace(/Â§Â§I(\d+)Â§Â§/g,(m,i)=>`<span class="math-inline">${inlines[i]}</span>`);
    return s;
  }
  window.MATH={htmlWithMath};
})();
</script>

<!-- ========== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø±Ø¶ ========== -->
<script>
(function(){
  const H = window.MATH.htmlWithMath;

  /* ÙƒØ´Ù Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ø¨Ø¯ÙˆÙ† $$ */
  function autoEq(s){
    if(!s) return s;
    const hasMathSign = /[=Â±â‰ˆÃ—Ã·]/.test(s) || /\\(frac|sqrt|sum|int|cdot|vec)\b/.test(s);
    const already = /\$/.test(s);
    return (!already && hasMathSign) ? `$$${s}$$` : s;
  }
  /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ø§Ù„ÙŠØ¯ÙˆÙŠ (Ù¡- .. 2. ..) */
  function stripLeadingNum(s){
    return (s||'').replace(/^\s*([0-9Ù -Ù©]+)\s*[\)\.\-â€“]\s*/,'').trim();
  }

  /* ØªØ­Ù„ÙŠÙ„ Ø³Ø·Ø± Ø§Ù„Ø±Ù…ÙˆØ²: "Ø§Ù„ÙˆØµÙ: ..ØŒ Ø§Ù„Ø±Ù…Ø²: XØŒ Ø§Ù„ÙˆØ­Ø¯Ø©: \mathrm{..}" */
  function parseSymbolRow(line){
    line=(line||'').trim();
    if(!line) return {desc:'â€”', sym:'â€”', unit:'â€”'};

    const m = line.match(/Ø§Ù„ÙˆØµÙ\s*[:=]\s*(.+?)\s*[ØŒ,]\s*Ø§Ù„Ø±Ù…Ø²\s*[:=]\s*([^\sØŒ,]+)\s*[ØŒ,]\s*Ø§Ù„ÙˆØ­Ø¯Ø©\s*[:=]\s*([^\sØŒ,]+)\s*$/);
    if(m) return {desc:m[1].trim(), sym:m[2].trim(), unit:m[3].trim()};

    const m2 = line.match(/Ø§Ù„ÙˆØµÙ\s*[â€“\-]\s*(.+?)\s*[ØŒ,]\s*Ø§Ù„Ø±Ù…Ø²\s*[:=]\s*([^\sØŒ,]+)\s*[ØŒ,]\s*Ø§Ù„ÙˆØ­Ø¯Ø©\s*[:=]\s*([^\sØŒ,]+)\s*$/);
    if(m2) return {desc:m2[1].trim(), sym:m2[2].trim(), unit:m2[3].trim()};

    const toks = line.split(/\s+/).filter(Boolean);
    if(toks.length>=3){
      const unit=toks[toks.length-1], sym=toks[toks.length-2], desc=toks.slice(0,-2).join(' ');
      return {desc:desc||'â€”', sym:sym||'â€”', unit:unit||'â€”'};
    }
    return {desc:line, sym:'â€”', unit:'â€”'};
  }

  function renderFormulasBox(list=[]){
    const box=document.createElement('div'); box.className='box center';
    list.forEach(f=>{
      const d=document.createElement('div'); d.className='math-block';
      const eq = /^\$\$/.test(f)? f : `$$${(f||'').replace(/^\$|\$$/g,'')}$$`;
      d.innerHTML=H(eq); box.appendChild(d);
    });
    return box;
  }

  function renderGivenUnknowns(givens=[], unknowns=[]){
    const tbl=document.createElement('table'); tbl.className='table center';
    tbl.innerHTML=`<thead><tr><th>Ø§Ù„Ø±Ù…Ø²</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„ÙˆØµÙ</th></tr></thead>`;
    const tb=document.createElement('tbody');

    (givens||[]).forEach(g=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${H(g.symbol||'')}</td><td>${H(g.value||'')}</td><td class="unit-cell">${H(g.unit||'')}</td><td>${H(g.desc||'')}</td>`;
      tb.appendChild(tr);
    });

    if((unknowns||[]).length){
      const tr=document.createElement('tr'); const td=document.createElement('td');
      td.colSpan=4; td.innerHTML='<span class="pill" style="display:inline-block;background:var(--bg2);border:1px solid var(--soft);border-radius:999px;padding:.25rem .6rem">Ø§Ù„Ù…Ø¬Ø§Ù‡ÙŠÙ„</span>'; tr.appendChild(td); tb.appendChild(tr);
      unknowns.forEach(u=>{
        const r=document.createElement('tr');
        r.innerHTML=`<td>${H(u.symbol||'')}</td><td>ØŸ</td><td class="unit-cell">â€”</td><td>${H(u.desc||'')}</td>`;
        tb.appendChild(r);
      });
    }
    tbl.appendChild(tb);
    return tbl;
  }

  function renderCase(container, data){
    const root=document.getElementById(container); root.innerHTML='';
    const frag=document.createDocumentFragment();

    const s1=document.createElement('div');
    s1.innerHTML=`<div class="sub">Ø§Ù„Ù…Ø³Ø£Ù„Ø©</div><div class="box">${H(data.scenario||'â€”')}</div>`;
    frag.appendChild(s1);

    const s2=document.createElement('div'); s2.className='sub'; s2.textContent='Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø¬Ø§Ù‡ÙŠÙ„';
    const b2=document.createElement('div'); b2.className='box'; b2.appendChild(renderGivenUnknowns(data.givens||[], data.unknowns||[]));
    frag.appendChild(s2); frag.appendChild(b2);

    const s3=document.createElement('div'); s3.className='sub'; s3.textContent='Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†/Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©';
    const b3=renderFormulasBox(data.formulas || (data.formula?[data.formula]:[]));
    frag.appendChild(s3); frag.appendChild(b3);

    const s4=document.createElement('div'); s4.className='sub'; s4.textContent='Ø§Ù„Ø­Ù„ ÙˆØ§Ù„Ø®Ø·ÙˆØ§Øª';
    const b4=document.createElement('div'); b4.className='box';
    const ol=document.createElement('ol');
    (data.steps||[]).forEach(step=>{
      const li=document.createElement('li');
      li.innerHTML=H( autoEq( stripLeadingNum(step) ) );
      ol.appendChild(li);
    });
    if((data.steps||[]).length) b4.appendChild(ol);

    if (data.result){
      const hr=document.createElement('div'); hr.style.height='1px'; hr.style.background='var(--soft)'; hr.style.margin='8px 0';
      b4.appendChild(hr);
      const big=document.createElement('div'); big.className='math-block';
      const eq = /^\$\$/.test(data.result)? data.result : `$$${data.result.replace(/^\$|\$$/g,'')}$$`;
      big.innerHTML=H(eq); b4.appendChild(big);
    }
    frag.appendChild(s4); frag.appendChild(b4);

    root.appendChild(frag);
    if (window.MathJax?.typesetPromise) MathJax.typesetPromise();
  }

  function renderExplain(d,concept){
    document.getElementById('exTitle').textContent = d.title || concept || '';
    document.getElementById('chip2').textContent  = concept || '';
    document.getElementById('overview').innerHTML = H(d.overview||'â€”');

    const expF=document.getElementById('expFormulas'); expF.innerHTML=''; expF.appendChild(renderFormulasBox(d.formulas||[]));

    const tb=document.getElementById('symbols'); tb.innerHTML='';
    (d.symbols||[]).forEach(line=>{
      const {desc,sym,unit}=parseSymbolRow(line);
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${H(desc)}</td><td>${H(sym)}</td><td class="unit-cell">${H(unit)}</td>`;
      tb.appendChild(tr);
    });

    const st=document.getElementById('steps'); st.innerHTML='';
    (d.steps||[]).forEach(s=>{
      const li=document.createElement('li'); 
      li.innerHTML=H( autoEq( stripLeadingNum(s) ) );
      st.appendChild(li);
    });

    document.getElementById('secExplain').style.display='block';
    if (window.MathJax?.typesetPromise) MathJax.typesetPromise();
  }

  window.UI={renderCase, renderExplain, H};
})();
</script>

<!-- ========== ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± + ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ========== -->
<script>
(function(){
  const $=id=>document.getElementById(id);
  const secs=['secExplain','secEx1','secEx2','secPractice','secSolve'];
  function hideAll(){ secs.forEach(id=>$(id).style.display='none'); const e=$('error'); e.style.display='none'; e.textContent=''; }
  function setBusy(t){ $('status').textContent=t||''; document.querySelectorAll('.btn').forEach(b=>b.disabled=!!t); }
  function showErr(m){ const e=$('error'); e.style.display='block'; e.textContent=m||'Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….'; }

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ø®ÙŠØ§Ø±
  const KEY='anees-theme';
  function applyTheme(val){ document.documentElement.classList.toggle('dark', val==='dark'); $('toggleTheme').textContent = (val==='dark'?'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­':'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†'); }
  applyTheme(localStorage.getItem(KEY)||'light');
  $('toggleTheme').addEventListener('click', ()=>{ const v = document.documentElement.classList.contains('dark')?'light':'dark'; localStorage.setItem(KEY,v); applyTheme(v); });

  let LAST_PRACTICE_QUESTION = '';

  async function call(action, extra){
    const concept=($('concept').value||'').trim();
    if(!concept){ showErr('Ø£Ø¯Ø®Ù„ÙŠ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†/Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø£ÙˆÙ„Ù‹Ø§.'); return null; }
    setBusy({
      explain:'Ø¬Ø§Ø±Ù ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø´Ø±Ø­â€¦',
      ex1:'Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø«Ø§Ù„â€¦',
      ex2:'Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„Ø¢Ø®Ø±â€¦',
      practice:'Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ¯Ø±ÙŠØ¨â€¦',
      solve:'Ø¬Ø§Ø±Ù Ø§Ù„Ø­Ù„â€¦'
    }[action] || 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¹Ù…Ù„â€¦');

    try{
      const res = await fetch('/.netlify/functions/anees', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({ action: mapAction(action), concept, question: (extra && extra.question) || null })
      });
      if(!res.ok){
        const txt=await res.text();
        throw new Error('Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…: '+res.status+' | '+txt.slice(0,400));
      }
      const out = await res.json();
      if(out && out.ok && out.data) return out.data;
      throw new Error(out?.error || 'Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….');
    }catch(err){
      showErr(err.message||'Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….');
      return null;
    }finally{
      setBusy('');
    }
  }

  function mapAction(a){
    return a==='ex1'?'example' : a==='ex2'?'example2' : a;
  }

  $('btnExplain').addEventListener('click', async ()=>{
    hideAll();
    const data = await call('explain');
    if(!data) return;
    UI.renderExplain(data, $('concept').value);
  });

  $('btnEx1').addEventListener('click', async ()=>{
    hideAll();
    const data = await call('ex1');
    if(!data) return;
    UI.renderCase('ex1', data);
    $('secEx1').style.display='block';
  });

  $('btnEx2').addEventListener('click', async ()=>{
    hideAll();
    const data = await call('ex2');
    if(!data) return;
    UI.renderCase('ex2', data);
    $('secEx2').style.display='block';
  });

  $('btnPractice').addEventListener('click', async ()=>{
    hideAll();
    const data = await call('practice');
    if(!data) return;
    LAST_PRACTICE_QUESTION = data.question || '';
    document.getElementById('practice').innerHTML = UI.H(LAST_PRACTICE_QUESTION || 'â€”');
    document.getElementById('secPractice').style.display='block';
    if (window.MathJax?.typesetPromise) MathJax.typesetPromise();
  });

  $('btnSolve').addEventListener('click', async ()=>{
    hideAll();
    if(!LAST_PRACTICE_QUESTION){ showErr('Ø§Ø¹Ø±Ø¶ÙŠ Ø£ÙˆÙ„Ø§Ù‹ Ø³Ø¤Ø§Ù„ "Ø§Ø®ØªØ¨Ø± ÙÙ‡Ù…ÙŠ" Ø«Ù… Ø§Ø¶ØºØ·ÙŠ "Ø§Ù„Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­".'); return; }
    const data = await call('solve', {question: LAST_PRACTICE_QUESTION});
    if(!data) return;
    UI.renderCase('solve', data);
    $('secSolve').style.display='block';
  });
})();
</script>
</body>
</html>
