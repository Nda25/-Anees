<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>

<style>
:root{--ink:#0f172a;--muted:#64748b;--sky-25:#f3f9ff;--sky-50:#eaf4ff;--sky-100:#e1f0ff;--btn:#1d97ff;--btn2:#0ea5e9;--card:#fff;--radius:16px}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;color:var(--ink);font-family:system-ui,-apple-system,'Segoe UI',Cairo,Roboto,sans-serif;background:
  radial-gradient(900px 500px at 0% -10%,var(--sky-100),transparent 60%),
  radial-gradient(900px 500px at 100% 110%,var(--sky-50),transparent 60%),
  linear-gradient(180deg,#fff,var(--sky-25) 85%)}
.wrap{max-width:1100px;margin:0 auto;padding:22px;min-height:100vh;display:flex;flex-direction:column}
header{text-align:center;margin:6px 0 16px}
header h1{font-size:clamp(26px,4.6vw,40px);margin:6px 0 4px;font-weight:900}
header p{color:var(--muted);margin:4px 0 0;font-size:clamp(14px,2.3vw,17px)}
.card{background:var(--card);border:1px solid rgba(2,132,199,.15);border-radius:var(--radius);box-shadow:0 12px 30px rgba(2,132,199,.10)}
.pad{padding:14px}
.inputs-container{display:flex;flex-direction:column;gap:12px}
.input-row{display:flex;flex-direction:column;width:100%}
.toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px;position:relative;z-index:1}
.btn{background:linear-gradient(180deg,var(--btn),var(--btn2));color:#fff;border:none;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:0 10px 20px rgba(14,165,233,.25);font-size:clamp(14px,2.4vw,16px);user-select:none;touch-action:manipulation}
.btn:disabled{opacity:.6;cursor:not-allowed}
.btn:active{transform:translateY(1px)}
.status{color:var(--muted);font-size:.95rem;text-align:center;min-height:1.2em;margin-top:6px}
.err{background:#fee2e2;color:#991b1b;border:1px solid #fecaca;padding:10px;border-radius:12px;display:none;margin-top:10px}
.sec{display:none;margin-top:12px}
.box{background:#f6fbff;border:1px solid #dbeafe;padding:12px;border-radius:12px}
.box ul,.box ol{margin:0 0 0 1.2rem}
.tag{display:inline-block;padding:.28rem .7rem;border-radius:999px;background:var(--sky-100);border:1px solid #cfe7ff;color:#0c4a6e;font-size:.9rem}
.math-inline,.math-block{direction:ltr;unicode-bidi:isolate}
.math-block{display:block;margin:.25rem 0}
footer{margin-top:auto;text-align:center;color:#64748b;padding:16px 0 40px;display:flex;flex-direction:column;align-items:center}
footer .teacher{color:#0f172a;font-weight:900;font-size:clamp(16px,3vw,20px);margin-top:10px}
footer .school{font-size:clamp(13px,2.2vw,15px)}
.select,.input{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:1rem}
.input-row{max-width:500px;margin:0 auto}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media (max-width:720px){.row{grid-template-columns:1fr}}
</style>

<!-- MathJax -->
<script>
window.MathJax={
  tex:{
    inlineMath:[['$','$'],['\\(','\\)']],
    displayMath:[['$$','$$'],['\\[','\\]']],
    processEscapes:true,
    packages:{'[+]':['noerrors','noundefined']}
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>
<div class="wrap">
<header>
  <h1>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ ğŸ¤–</h1>
  <p>ÙˆØ¬Ù‡ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„ØªØ¨Ø³ÙŠØ· Ù‚ÙˆØ§Ù†ÙŠÙ† <strong>Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ ÙˆØ§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</strong>.</p>
</header>

<section class="card pad">
  <div class="inputs-container">
    <div class="input-row">
      <label for="subject">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
      <select id="subject" class="select">
        <option>Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</option><option>Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</option><option>Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
      </select>
    </div>
    <div class="input-row">
      <label for="concept">Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†/Ø§Ù„Ù…ÙÙ‡ÙˆÙ… (Ø¨Ø§Ù„Ù†Øµ Ø£Ùˆ Ø¨Ø§Ù„Ø±Ù…ÙˆØ²):</label>
      <input id="concept" class="input" placeholder="Ø§Ù„Ø³Ù‚ÙˆØ· Ø§Ù„Ø­Ø± â€” Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆÙ„Ø§Øª â€” ÙÙŠØ«Ø§ØºÙˆØ±Ø³" autocomplete="off"/>
    </div>
  </div>

  <div class="toolbar" role="group" aria-label="Ø§Ù„Ø£ÙˆØ§Ù…Ø±">
    <button type="button" class="btn" id="btnExplain">Ø§Ø´Ø±Ø­ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† ğŸ“˜</button>
    <button type="button" class="btn" id="btnEx1">Ù…Ø«Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ÙŠ ğŸ’¡</button>
    <button type="button" class="btn" id="btnEx2">Ù…Ø«Ø§Ù„ Ø¢Ø®Ø± ğŸ’¡</button>
    <button type="button" class="btn" id="btnPractice">Ù…Ø³Ø£Ù„Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© ğŸ“</button>
    <button type="button" class="btn" id="btnSolve">Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­ ğŸ”‘</button>
  </div>

  <div id="status" class="status" aria-live="polite"></div>
  <div id="error" class="err" role="alert"></div>
</section>

<section id="secExplain" class="sec card pad" aria-live="polite">
  <h2 id="exTitle" style="margin-top:0"></h2>
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin:-4px 0 8px">
    <span id="chip1" class="tag"></span><span id="chip2" class="tag"></span>
  </div>
  <h3>Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø®ØªØµØ±</h3>
  <div id="overview" class="box"></div>

  <div class="row" style="margin-top:10px">
    <div>
      <h3>Ø§Ù„ØµÙŠØº</h3><ul id="formulas" class="box"></ul>
    </div>
    <div>
      <h3>Ø§Ù„Ø±Ù…ÙˆØ²</h3><ul id="symbols" class="box"></ul>
    </div>
  </div>

  <h3 style="margin-top:10px">Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…/Ø§Ù„Ø­Ù„</h3>
  <ol id="steps" class="box"></ol>
</section>

<section id="secEx1" class="sec card pad"><h2>Ù…Ø«Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ÙŠ</h2><div id="ex1" class="box"></div></section>
<section id="secEx2" class="sec card pad"><h2>Ù…Ø«Ø§Ù„ Ø¢Ø®Ø±</h2><div id="ex2" class="box"></div></section>
<section id="secPractice" class="sec card pad"><h2>Ø³Ø¤Ø§Ù„ Ù„Ù„ØªØ¯Ø±ÙŠØ¨</h2><div id="practice" class="box"></div></section>
<section id="secSolve" class="sec card pad"><h2>Ø§Ù„Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­</h2><div id="solve" class="box"></div></section>

<footer>
  <div>ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨Ø¥ØªÙ‚Ø§Ù† Ù„ØªØ¨Ø³ÙŠØ· ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ø¹Ù„ÙˆÙ…</div>
  <div class="teacher">Ù…Ø¹Ù„Ù…Ø© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡: Ù†Ø¯Ù‰ Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…Ø¬ÙŠØ±Ø´</div>
  <div class="school">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© â€“ Ø§Ù„Ø±ÙŠØ§Ù†</div>
</footer>
</div>

<!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø§Ø«/Ø§Ù„ÙˆØ­Ø¯Ø§Øª -->
<script>
(function(){
  function cleanMath(s){
    s=(s||'').replace(/\r/g,'\n').replace(/\n{3,}/g,'\n\n');
    s=s.replace(/\\\\/g,'\\').replace(/\$approx\b/gi,'\\approx');
    return s.trim();
  }
  function hasMathDelims(s){ return /(\$\$[\s\S]*?\$\$|\$[^$]+\$|\\\(|\\\[)/.test(s||''); }
  function looksLikeMath(s){ return /[=^_]|\\(frac|sqrt|mathrm|sum|int)\b|[A-Za-z]\s*\/\s*[A-Za-z]/.test(s||''); }

  function fixLatex(s){
    s = cleanMath(s||'');
    s = s.replace(/(^|[^\\])\b(frac|sqrt|mathrm|sum|int)\b/g,'$1\\$2');
    const unitAlt = [
      'mol','g','kg','mg','Âµg','m','cm','mm','km','s','ms','min','h','A','V','N','Pa','kPa','MPa',
      'J','kJ','W','kW','MW','Hz','C','K','Â°C','L','mL','cm\\^3','dm\\^3','atm','bar','mmHg','Torr',
      'Ohm','F','H','m/s','m/s\\^2','km/h','mol/L','M','g/mol','rad','rad/s'
    ].join('|');
    const unitPlain = unitAlt.replace(/\\\^/g,'^').replace(/\\\//g,'/');
    s = s.replace(/\\\[\s*\\?mathrm\{([^}]+)\}\s*\\\]/g,'\\,\\mathrm{$1}');
    if (hasMathDelims(s)){
      s = s.replace(new RegExp('(\\d+(?:[.,]\\d+)?)\\s+('+unitAlt+')\\b','g'),'$1\\\\,\\\\mathrm{$2}');
      s = s.replace(/[\(\[\{]\s*\\?mathrm\{([^}]+)\}\s*[\)\]\}]/g,'\\,\\mathrm{$1}');
    } else {
      s = s.replace(new RegExp('(\\d+(?:[\\.,]\\d+)?)\\s*('+unitPlain+')','g'),'$$$1\\\\,\\\\mathrm{$2}$');
    }
    return s;
  }

  // âœ… ÙŠØ­ÙØ¸ $$..$$ Ùˆ $..$ Ø«Ù… ÙŠÙ…Ø³Ø­ Ø£ÙŠ $ ÙŠØªÙŠÙ…Ø©
  function htmlWithMath(sp){
    let s = fixLatex(sp||'');

    // Ø§Ø­ÙØ¸ $$...$$ Ù…Ø¤Ù‚ØªÙ‹Ø§
    const blocks = [];
    s = s.replace(/\$\$([\s\S]*?)\$\$/g,(m,inner)=>{
      blocks.push('$$'+inner+'$$');
      return 'Â§Â§BLOCK'+(blocks.length-1)+'Â§Â§';
    });

    // Ø§Ø­ÙØ¸ $...$ Ù…Ø¤Ù‚ØªÙ‹Ø§
    const inlines = [];
    s = s.replace(/\$([^$]+)\$/g,(m,inner)=>{
      inlines.push('$'+inner+'$');
      return 'Â§Â§INL'+(inlines.length-1)+'Â§Â§';
    });

    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ $ ÙŠØªÙŠÙ…Ø©
    s = s.replace(/\$/g,'');

    // Ø£Ø±Ø¬Ø¹Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ø³Ø¨Ø§Ù†Ø§Øª MathJax
    s = s.replace(/Â§Â§BLOCK(\d+)Â§Â§/g,(m,i)=>`<span class="math-block">$$${blocks[i].slice(2,-2)}$$</span>`)
         .replace(/Â§Â§INL(\d+)Â§Â§/g,(m,i)=>`<span class="math-inline">$${inlines[i].slice(1,-1)}$</span>`);
    return s;
  }

  window._MathFix = { hasMathDelims, looksLikeMath, fixLatex, htmlWithMath };
})();
</script>

<!-- Ù…Ù†Ø¹ Ø§Ù†Ø¹ÙƒØ§Ø³ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙÙŠ Ø³Ø·Ø± Ø§Ù„Ø±Ù…ÙˆØ² -->
<script>
(function(){
  const hasMathDelims = (s)=>window._MathFix.hasMathDelims(s);
  const looksLikeMath = (s)=>window._MathFix.looksLikeMath(s);

  function renderSymbolLine(raw){
    const s = raw || '';
    const idx = s.search(/[\u0600-\u06FF]/);
    const li = document.createElement('li');

    if (idx > 0){
      const left  = s.slice(0, idx).trim();
      const right = s.slice(idx).trim();
      const leftPrepared = hasMathDelims(left) ? left : (looksLikeMath(left) ? `$${left}$` : left);

      const span = document.createElement('span');
      span.innerHTML = window._MathFix.htmlWithMath(leftPrepared);
      li.appendChild(span);
      li.appendChild(document.createTextNode(' ' + right));
    } else {
      li.innerHTML = window._MathFix.htmlWithMath(s);
    }
    return li;
  }

  window._RTLFix = { renderSymbolLine };
})();
</script>

<!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© -->
<script>
(function(){
  const $=(id)=>document.getElementById(id);
  const secs=['secExplain','secEx1','secEx2','secPractice','secSolve'];

  function hideAll(){
    secs.forEach(s=>$(s).style.display='none');
    const e=$('error'); if(e){ e.style.display='none'; e.textContent=''; }
  }
  function setBusy(txt){
    $('status').textContent=txt||'';
    document.querySelectorAll('.btn').forEach(b=>b.disabled=!!txt);
  }
  function showErr(msg){
    const e=$('error'); e.style.display='block';
    e.textContent=(typeof msg==='string' && msg)? ('Error: '+msg) : 'Error: Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.';
  }
  function typeset(){
    if(window.MathJax && MathJax.typesetPromise){ MathJax.typesetPromise(); }
  }

  const htmlWithMath     = window._MathFix.htmlWithMath;
  const renderSymbolLine = window._RTLFix.renderSymbolLine;

  function renderExplain(d,subject,concept){
    $('exTitle').textContent = (d.title||concept||'').toString();
    $('chip1').textContent = subject; $('chip2').textContent = concept;
    $('overview').innerHTML = htmlWithMath(d.overview||'â€”');

    const f=$('formulas'); f.innerHTML='';
    (d.formulas||[]).forEach(s=>{const li=document.createElement('li'); li.innerHTML=htmlWithMath(s); f.appendChild(li);});

    const sy=$('symbols'); sy.innerHTML='';
    (d.symbols||[]).forEach(s=>{sy.appendChild(renderSymbolLine(s));});

    const st=$('steps'); st.innerHTML='';
    (d.steps||[]).forEach(s=>{const li=document.createElement('li'); li.innerHTML=htmlWithMath(s); st.appendChild(li);});

    $('secExplain').style.display='block'; typeset();
  }

  function renderExample(boxId,secId,d){
    const box=$(boxId); const frag=document.createDocumentFragment();
    if (d.title){ const h=document.createElement('div'); h.style.fontWeight='700'; h.textContent=d.title; frag.appendChild(h); }
    if (d.scenario){ const p=document.createElement('div'); p.innerHTML='<em>Ø§Ù„Ù…Ø³Ø£Ù„Ø©:</em> '+htmlWithMath(d.scenario); frag.appendChild(p); }

    if (Array.isArray(d.given)&&d.given.length){
      const p=document.createElement('div'); p.innerHTML='<em>Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª:</em>';
      const ul=document.createElement('ul');
      d.given.forEach(x=>{const li=document.createElement('li'); li.innerHTML=htmlWithMath(x); ul.appendChild(li);});
      p.appendChild(ul); frag.appendChild(p);
    }
    if (d.required){ const p=document.createElement('div'); p.innerHTML='<em>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</em> '+htmlWithMath(d.required); frag.appendChild(p); }
    if (Array.isArray(d.steps)&&d.steps.length){
      const p=document.createElement('div'); p.innerHTML='<em>Ø§Ù„Ø®Ø·ÙˆØ§Øª:</em>';
      const ol=document.createElement('ol');
      d.steps.forEach(x=>{const li=document.createElement('li'); li.innerHTML=htmlWithMath(x); ol.appendChild(li);});
      p.appendChild(ol); frag.appendChild(p);
    }
    if (d.result){ const p=document.createElement('div'); p.innerHTML='<em>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</em> '+htmlWithMath(d.result); frag.appendChild(p); }
    if (d.formula){ const div=document.createElement('div'); div.className='math-block'; div.innerHTML=htmlWithMath(d.formula); div.style.marginTop='6px'; frag.appendChild(div); }
    box.innerHTML=''; box.appendChild(frag); $(secId).style.display='block'; typeset();
  }

  function renderPractice(d){
    $('practice').innerHTML = htmlWithMath(d.question||'â€”');
    $('secPractice').style.display='block'; typeset();
  }

  function renderSolve(d){
    const solveBox=$('solve'); solveBox.innerHTML='';
    const solutionText=d.solution||'â€”';
    const parts=solutionText.split(/(\*\*[\Ø³\S]+?\*\*)/g).filter(p=>p.trim()!=='');
    parts.forEach(part=>{
      if(part.startsWith('**')&&part.endsWith('**')){
        const h3=document.createElement('h3'); h3.style.marginTop='10px';
        h3.textContent=part.replace(/^\*\*|\*\*$/g,''); solveBox.appendChild(h3);
      }else{
        const lines=part.split(/\n+/).filter(line=>line.trim()!=='');
        if(lines.length>0){
          const ol=document.createElement('ol');
          lines.forEach(line=>{const li=document.createElement('li'); li.innerHTML=htmlWithMath(line.trim()); ol.appendChild(li);});
          solveBox.appendChild(ol);
        }
      }
    });
    $('secSolve').style.display='block'; typeset();
  }

  // Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ + ØªÙ‚Ø§Ø±ÙŠØ± Ø®Ø·Ø£ Ù†Ø¸ÙŠÙØ©
  let inFlight = false;
  function go(action,extra){
    if (inFlight) return;
    hideAll();

    const subject=$('subject').value;
    const concept=($('concept').value||'').trim();
    if(!concept){ showErr('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†/Ø§Ù„Ù…ÙÙ‡ÙˆÙ… Ø£ÙˆÙ„Ù‹Ø§.'); return; }

    const loadingMsg={
      explain:'Ø¬Ø§Ø±Ù ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø´Ø±Ø­â€¦',
      example:'Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠâ€¦',
      example2:'Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø«Ø§Ù„ Ø¢Ø®Ø±â€¦',
      practice:'Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø£Ù„Ø©â€¦',
      solve:'Ø¬Ø§Ø±Ù Ø§Ù„Ø­Ù„â€¦'
    }[action]||'Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©â€¦';

    inFlight = true;
    setBusy(loadingMsg);

    google.script.run
      .withSuccessHandler(res=>{
        setBusy(''); inFlight=false;
        if(!res||!res.ok){ showErr((res&&res.error)||'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©.'); return; }
        const d=res.data||{};
        if(action==='explain')renderExplain(d,subject,concept);
        if(action==='example')renderExample('ex1','secEx1',d);
        if(action==='example2')renderExample('ex2','secEx2',d);
        if(action==='practice')renderPractice(d);
        if(action==='solve')renderSolve(d);
      })
      .withFailureHandler(err=>{
        setBusy(''); inFlight=false;
        const msg = (err && typeof err==='object' && err.message) ? err.message :
                    (typeof err==='string' ? err : 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.');
        showErr(msg);
      })
      .doAction(action,subject,concept,extra||null);
  }

  // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø¬Ø§Ù‡Ø²ÙŠØ© DOM
  window.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('btnExplain').addEventListener('click', ()=>go('explain'));
    document.getElementById('btnEx1').addEventListener('click', ()=>go('example'));
    document.getElementById('btnEx2').addEventListener('click', ()=>go('example2'));
    document.getElementById('btnPractice').addEventListener('click', ()=>go('practice'));
    document.getElementById('btnSolve').addEventListener('click', ()=>{
      const q=document.getElementById('practice').textContent?.trim();
      go('solve', q?{question:q}:null);
    }, { passive:true });
  });
})();
</script>
</body>
</html>
